#!/bin/sh

set -e

munge() {
    printf %s "$1" | tr . _ | tr -d -c '[:alnum:]_'
}

quote() {
    sed 's/\\/\\\\/g' | sed 's/"/\\"/g' | sed 's/$/\\n/' | tr -d '\n'
}

nameof() {
    readlink /proc/self/fd/0
}

pkg_path=$1
shift

pkg=`basename $pkg_path`

file=`nameof`

printf 'package %s\n' "$pkg"
printf '\n'
printf '// This file was generated from %s.\n' "$file"
printf '\n'
printf 'var '
munge "`basename $file`"
printf ' string = "'
quote
printf '"\n'
